(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpag/readBook/readBook"],{"0e71":function(t,e,r){"use strict";r.r(e);var n=r("b66e"),a=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(i);e["default"]=a.a},"29e5":function(t,e,r){"use strict";(function(t,e){var n=r("4ea4");r("e655");n(r("66fd"));var a=n(r("750e"));t.__webpack_require_UNI_MP_PLUGIN__=r,e(a.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},"750e":function(t,e,r){"use strict";r.r(e);var n=r("7aa1"),a=r("0e71");for(var i in a)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return a[t]}))}(i);r("e60a");var o=r("f0c5"),s=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=s.exports},"7aa1":function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return n}));var n={uniIcons:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(r.bind(null,"5486"))},uniDrawer:function(){return r.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(r.bind(null,"6800"))}},a=function(){var t=this,e=t.$createElement,r=(t._self._c,t.__map(t.chapterPages,(function(e,r){var n=t.__get_orig(e),a=Array.isArray(e),i=Array.isArray(e);return{$orig:n,g0:a,g1:i}})));t.$mp.data=Object.assign({},{$root:{l0:r}})},i=[]},b66e:function(t,e,r){"use strict";(function(t){var n=r("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=n(r("2eee")),i=n(r("448a")),o=n(r("c973")),s=n(r("9523")),c=r("26cb");function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){(0,s.default)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={data:function(){var t;return t={book:{},id:"",chapterList:[],pageSize:500,page:1,chapterPages:[],isloading:!1,chapterIndex:0},(0,s.default)(t,"isloading",!1),(0,s.default)(t,"isShowBookrack",!1),(0,s.default)(t,"isShow",!1),(0,s.default)(t,"currentIndex",0),(0,s.default)(t,"books",[]),t},onLoad:function(e){var r=this;this.book=JSON.parse(e.book||"[]"),this.books=JSON.parse(t.getStorageSync("bookrack")||"[]"),this.id=this.book.fictionId,this.chapterIndex=t.getStorageSync(this.id+"-chapterIndex")||0,this.chapterList=JSON.parse(t.getStorageSync(this.id+"-chapterList")||"[]"),this.chapterPages=JSON.parse(t.getStorageSync(this.id+"-chapterPages")||"[]"),this.chapterPages.length||(0,o.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.getBookChapter();case 2:r.getBookContent(r.chapterList[0].chapterId);case 3:case"end":return t.stop()}}),t)})))(),this.isInBookrack()},onReady:function(){var e=t.getStorageSync(this.id+"currentIndex");e&&(this.currentIndex=e)},onUnload:function(){var e=Number(this.currentIndex);t.setStorageSync(this.id+"currentIndex",e),t.setStorageSync(this.id+"-chapterIndex",this.chapterIndex),this.isShowBookrack&&(t.removeStorageSync(this.id+"-chapterList"),t.removeStorageSync(this.id+"-chapterPages"),t.removeStorageSync(this.id+"currentIndex"),t.removeStorageSync(this.id+"-chapterIndex"))},methods:u(u({},(0,c.mapMutations)("book",["addBooks","saveStorage","updateBooks"])),{},{getBookChapter:function(){var e=this;return(0,o.default)(a.default.mark((function r(){var n,i;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.get("/fictionChapter/search/".concat(e.id));case 2:n=r.sent,200==n.statusCode?(e.chapterList=n.data.data.chapterList,t.setStorageSync(e.id+"-chapterList",JSON.stringify(e.chapterList))):t.$showMsg(),i=e.chapterList[e.chapterIndex].chapterId,i&&!e.chapterPages.length&&e.getBookContent(i);case 6:case"end":return r.stop()}}),r)})))()},getBookContent:function(e,r){var n=this;return(0,o.default)(a.default.mark((function i(){var o,s,c;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.isloading=!0,o=n.chapterIndex,a.next=4,t.$http.get("/fictionContent/search/".concat(e));case 4:s=a.sent,200==s.statusCode?(c=s.data.data,n.addChapter(o,e,c,r),t.setStorageSync(n.id+"-chapterPages",JSON.stringify(n.chapterPages))):t.$showMsg(),n.isloading=!1;case 7:case"end":return a.stop()}}),i)})))()},addChapter:function(t,e,r,n){var a=[],o=this.chapterList[t].title,s=o+"___"+r;a=this.paging(a,s);var c=a[0].split("___"),h=[c[0],c[1]];a[0]=h,this.chapterPages=[].concat((0,i.default)(this.chapterPages),(0,i.default)(a)),this.chapterPages=(0,i.default)(new Set(this.chapterPages))},paging:function(t,e){while(e.length>this.pageSize)t.push(e.slice(0,this.pageSize)),e=e.slice(this.pageSize);return t.push(e),t},isInBookrack:function(){var t=this;this.isShowBookrack=!0,this.books.forEach((function(e){e.fictionId==t.book.fictionId&&(t.isShowBookrack=!1)}))},showBox:function(){this.isShow=!this.isShow},showDrawer:function(){this.$refs.showRight.open()},closeDrawer:function(){this.$refs.showRight.close()},swiperMove:function(t){if(this.currentIndex=t.detail.current,t.detail.current==this.chapterPages.length-1){if(this.isloading)return;if(this.chapterIndex=Number(this.chapterIndex)+1,this.chapterIndex>this.chapterList.length)return;var e=this.chapterList[this.chapterIndex].chapterId;this.getBookContent(e)}},intoReadBook:function(e){this.closeDrawer(),this.chapterIndex=e,this.chapterPages=[],t.removeStorageSync(this.id+"currentIndex"),this.getBookContent(this.chapterList[e].chapterId)},getPrevious:function(t){if(0==this.currentIndex&&t.detail.dx<0){var e=this.chapterIndex;0!=e&&this.getBookContent(this.chapterList[e-1].chapterId,!0)}},buttonAdd:function(){this.addBooks(this.book),this.saveStorage(),this.isShow=!1,this.isShowBookrack=!1},buttonDelete:function(){var t=this;this.isShow=!1;var e=this.books.filter((function(e){return e.fictionId!=t.book.fictionId}));this.updateBooks(e),this.saveStorage(),this.isShowBookrack=!0}})};e.default=d}).call(this,r("543d")["default"])},e60a:function(t,e,r){"use strict";var n=r("f5d8"),a=r.n(n);a.a},f5d8:function(t,e,r){}},[["29e5","common/runtime","common/vendor"]]]);