{"version":3,"sources":["webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?d289","webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?6078","webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?db38","webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?8c59","uni-app:///subpag/searchBook/searchBook.vue","webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?9df1","webpack:///D:/wxApp/111/subpag/searchBook/searchBook.vue?3b9f","uni-app:///main.js"],"names":["data","bookValue","bookList","timer","isloading","page","total","historyList","onLoad","methods","searchBook","from","size","uni","result1","result2","list1","list2","idSet","book","title","duration","icon","clear","input","clearTimeout","onReachBottom","onPullDownRefresh","bookDetail","url","toSearch","clearHistory","wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuH;AACvH;AAC8D;AACL;AACc;;;AAGvE;AAC0K;AAC1K,gBAAgB,mLAAU;AAC1B,EAAE,gFAAM;AACR,EAAE,qFAAM;AACR,EAAE,8FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,mWAEN;AACP,KAAK;AACL;AACA,aAAa,kLAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtCA;AAAA;AAAA;AAAA;AAA6nB,CAAgB,kpBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCiCjpB;EACAA;IACA;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;MACA;MACAC;IACA;EACA;EACAC;IACA;IACA;EACA;EACAC;IACA;IACAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAC;gBAAAC;gBACA;gBACA;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OAOAC;cAAA;gBAAAC;gBAAA;gBAAA,OAEAD;cAAA;gBAAAE;gBAAA,MACAD;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA,MACAC;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACAC;gBACAC;gBACA;kBACAD;gBACA;gBACA;kBACAC;gBACA;gBACA;gBACA;gBACA;gBACAC;kBAAA;gBAAA,KACA;gBACA;kBAAAC;kBACA;kBACA;oBACA;oBACA;oBACA;oBACAD;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAEA;gBACAL;kBACAO;kBACAC;kBACAC;gBACA;cAAA;gBAEA;gBACA;gBACA;gBACAT;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAU;MACA;MACA;IACA;IACA;IACAC;MAAA;MACAC;MACA;MACA;QACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;QAAA;MAAA;IACA;IACA;IACAC;MAAA;QAAA;UAAA;YAAA;cAAA;gBACAT;gBACAN;kBACAgB;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAC;MACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACAlB;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AChKA;AAAA;AAAA;AAAA;AAAypC,CAAgB,0nCAAG,EAAC,C;;;;;;;;;;;ACA7qC;AACA,OAAO,KAAU,EAAE,kBAKd;;;;;;;;;;;;;;;;ACNL;AAGA;AACA;AAHA;AACAmB,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,mBAAI,CAAC,C","file":"subpag/searchBook/searchBook.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./searchBook.vue?vue&type=template&id=3076bd64&\"\nvar renderjs\nimport script from \"./searchBook.vue?vue&type=script&lang=js&\"\nexport * from \"./searchBook.vue?vue&type=script&lang=js&\"\nimport style0 from \"./searchBook.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpag/searchBook/searchBook.vue\"\nexport default component.exports","export * from \"-!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--17-0!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./searchBook.vue?vue&type=template&id=3076bd64&\"","var components\ntry {\n  components = {\n    uniSearchBar: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar\" */ \"@/uni_modules/uni-search-bar/components/uni-search-bar/uni-search-bar.vue\"\n      )\n    },\n    history: function () {\n      return import(\n        /* webpackChunkName: \"components/history/history\" */ \"@/components/history/history.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./searchBook.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--13-1!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./searchBook.vue?vue&type=script&lang=js&\"","<template>\n  <view>\r\n    <!-- 顶部搜索区域 -->\n    <view class=\"search-top\"> \r\n      <uni-search-bar clearButton=\"auto\" cancelButton=\"none\" radius=\"100\" @confirm=\"searchBook(page)\" v-model=\"bookValue\" @clear=\"clear\" bgColor=\"white\" placeholder=\"搜索书名或作者\" @input=\"input\"></uni-search-bar>\r\n    </view>\r\n    <!-- 历史区域 -->\r\n    <!-- <view class=\"search-history\"  v-if=\"!bookList.length\">\r\n        <view class=\"search-history-top\">\r\n          <text>搜索历史</text>\r\n          <text @click=\"clearHistory\">清除</text>\r\n        </view>\r\n        <view class=\"search-history-bottom\">\r\n          <uni-tag :text=\"item\" v-for=\"(item, i) in historyList\" :key=\"i\" class=\"uni-tag\" @click=\"toSearch(item)\"></uni-tag>\r\n        </view>\r\n    </view> -->\r\n    <history :list=\"bookList\" :historyList=\"historyList\" @clearHistory=\"clearHistory\" @toSearch=\"toSearch\"></history>\r\n    <!-- 书籍列表展示区 -->\r\n    <view class=\"search-bottom\">\r\n      <view class=\"search-bottom-list\" v-for=\"(book,index) in bookList\" :key=\"index\" @click=\"bookDetail(book)\">\r\n        <img :src=\"book.cover\" alt=\"\" srcset=\"\">\r\n        <view class=\"search-bottom-list-right\">\r\n          <text>{{book.title}}</text>\r\n          <text>作者：{{book.author}}</text>\r\n          <text class=\"tag\">{{book.fictionType}}</text>\r\n          <text>简介：{{book.descs}}</text>\r\n        </view>\r\n      </view>\r\n    </view>\n  </view>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\r\n        //搜索框的值\n        bookValue:'',\r\n        //搜索的书籍列表\r\n        bookList:[],\r\n        //定时器\r\n        timer:null,\r\n        // 是否正在请求数据\r\n        isloading: false,\r\n        //当前页\r\n        page:1,\r\n        //总数据\r\n        total:0,\r\n         // 搜索关键词的历史记录\r\n        historyList: []\n      };\n    },\r\n    onLoad() {\r\n      //从本地取出历史记录\r\n      this.historyList = JSON.parse(uni.getStorageSync('history') || '[]')\r\n    },\r\n    methods:{\r\n      //搜索书籍\r\n      async searchBook(e,from = 1,size = 10){\r\n         //打开节流阀\r\n        this.isloading = true\r\n        if(this.bookValue){\r\n          /*\r\n          因为无法判断用户输入的内容是按照作者还是标题进行搜索的\r\n          所以分别发送两次请求\r\n          最后将结果合并放入书籍列表中\r\n          */\r\n          //按标题进行搜索\r\n         let result1 = await uni.$http.get(`/fiction/search/title/${this.bookValue}/${from}/${size}`)\r\n         // 按作者进行搜索\r\n         let result2 = await uni.$http.get(`/fiction/search/author/${this.bookValue}/${from}/${size}`)\r\n         if (result1.statusCode !== 200) return uni.$showMsg()\r\n         if (result2.statusCode !== 200) return uni.$showMsg()\r\n         let list1 = [];\r\n         let list2 = [];\r\n         if(result1.data.data){\r\n           list1 = result1.data.data\r\n         }\r\n         if(result2.data.data){\r\n           list2 = result2.data.data\r\n         }\r\n         this.isloading = false\r\n         this.total = result1.data.count + result2.data.count\r\n         //将bookList已有元素的id存入set\r\n         const idSet = new Set(this.bookList.map(item=>item.fictionId))\r\n         //循环新的请求结果\r\n         for(const book of [...list1,...list2]){\r\n           //判断新的结果中是否重复：如果它的id在set中已经存在，就重复了\r\n           if (!idSet.has(book.fictionId)) {\r\n             //没有重复，将其添加进booList中\r\n             this.bookList.push(book);\r\n             //没有重复，将新的id加入set\r\n             idSet.add(book.fictionId);\r\n           }\r\n         }\r\n      }else{\r\n        // 用户没有输入内容就进行搜索时 触发\r\n        uni.showToast({\r\n          title:'请输入要搜索的内容',\r\n          duration:1000,\r\n          icon:'none'\r\n        })\r\n      }\r\n      this.historyList.unshift(this.bookValue)\r\n      this.historyList = Array.from(new Set(this.historyList))\r\n      // 调用 uni.setStorageSync(key, value) 将搜索历史记录持久化存储到本地\r\n        uni.setStorageSync('history', JSON.stringify(this.historyList))\r\n      },\r\n      //用户点击清除\r\n      clear(){\r\n        this.bookValue = ''\r\n        this.bookList = []\r\n      },\r\n      //input\r\n      input(e){\r\n        clearTimeout(this.timer)\r\n         // 重新启动一个延时器，并把 timerId 赋值给 this.timer\r\n         this.timer = setTimeout(() => {\r\n           // 如果 500 毫秒内，没有触发新的输入事件，则为搜索关键词赋值\r\n           this.kw = e.value\r\n         }, 500)\r\n      },\r\n      // 触底的事件\r\n      onReachBottom() {\r\n        // 判断是否还有下一页数据\r\n        if (this.page* 10 >= this.total) return uni.$showMsg('没有了哦！')\r\n        // 判断是否正在请求其它数据，如果是，则不发起额外的请求\r\n          if (this.isloading) return\r\n          this.page += 1;\r\n          this.searchBook(this.page)\r\n      },\r\n      // 下拉刷新的事件\r\n      onPullDownRefresh() {\r\n        // 重置关键数据\r\n        this.page = 1\r\n        this.total = 0\r\n        this.isloading = false\r\n        this.bookList = []\r\n        // 2. 重新发起请求\r\n        this.searchBook(() => uni.stopPullDownRefresh())\r\n      },\r\n      //书籍详情\r\n      async bookDetail(book){\r\n        book = JSON.stringify(book)\r\n        uni.navigateTo({\r\n          url:'/subpag/bookDetail/bookDetail?book='+ book\r\n        })\r\n      },\r\n      //点击tag自动搜索\r\n      toSearch(item){\r\n        this.bookValue = item\r\n        this.searchBook()\r\n      },\r\n      //清除历史\r\n      clearHistory(){\r\n        this.historyList = []\r\n        // 清空本地存储中记录的搜索历史\r\n        uni.setStorageSync('kw', '[]')\r\n      }\r\n    }\r\n  }\n</script>\n\n<style lang=\"less\">\n.search-top{\r\n  background-color:#acff7f ;\r\n}\r\n.search-bottom{\r\n  .search-bottom-list{\r\n    display: flex;\r\n    margin-bottom: 30rpx;\r\n    img{\r\n      width: 33%;\r\n    }\r\n    .search-bottom-list-right{\r\n      width: 66%;\r\n      height: 400rpx;\r\n      margin-left: 20rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      text:first-child{\r\n        font-size: 40rpx;\r\n        font-weight: bold;\r\n      }\r\n      .tag{\r\n        width: 200rpx;\r\n        text-align: center;\r\n        height: 40rpx;\r\n        border: 2rpx solid black;\r\n        background-color: #B22222;\r\n        color: white;\r\n      }\r\n      text:last-child{\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n      }\r\n    }\r\n  }\r\n}\n</style>\n","import mod from \"-!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--10-oneOf-1-0!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-1!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-2!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--10-oneOf-1-3!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\less-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-4!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-5!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./searchBook.vue?vue&type=style&index=0&lang=less&\"; export default mod; export * from \"-!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--10-oneOf-1-0!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-1!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-2!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--10-oneOf-1-3!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\less-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-4!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-5!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\IDM\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./searchBook.vue?vue&type=style&index=0&lang=less&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1683698204005\n      var cssReload = require(\"E:/IDM/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpag/searchBook/searchBook.vue'\ncreatePage(Page)"],"sourceRoot":""}